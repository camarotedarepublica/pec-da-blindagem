<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Acompanhe como os deputados votaram na PEC da Blindagem (PEC 3/2021). Consulte votos, contatos e informações dos parlamentares para protestar contra a impunidade." />
    <meta property="og:image" content="meta.jpg" />
    <title>PEC da Blindagem</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet" />
</head>

<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container-fluid text-white">
            <h1 class="fs-4 mb-0 w-100 d-block text-center">
                <i class="bi bi-shield-fill-check me-2"></i>
                PEC da Blindagem
            </h1>
        </div>
    </nav>

    <div class="container mt-2 ps-0 pe-0 ps-md-2 pe-md-2">
        <div class="row mb-3 mt-3 ms-1 me-1">
            <div class="col-md-3">
                <label for="filtroNome" class="form-label">
                    <i class="bi bi-search"></i> Nome
                </label>
                <input type="text" class="form-control" id="filtroNome" placeholder="Filtrar por nome..." />
            </div>
            <div class="col-6 col-md-2 mt-2 mt-md-0">
                <label for="filtroPartido" class="form-label">
                    <i class="bi bi-flag"></i> Partido
                </label>
                <select class="form-select" id="filtroPartido">
                    <option value="">Todos</option>
                </select>
            </div>
            <div class="col-6 col-md-1 mt-2 mt-md-0">
                <label for="filtroUF" class="form-label">
                    <i class="bi bi-geo-alt"></i> UF
                </label>
                <select class="form-select" id="filtroUF">
                    <option value="">Todos</option>
                </select>
            </div>
            <div class="col-6 col-md-1 mt-2 mt-md-0">
                <label for="filtroVoto1Turno" class="form-label">
                    <i class="bi bi-check-circle"></i> 1º Turno
                </label>
                <select class="form-select" id="filtroVoto1Turno">
                    <option value="">Todos</option>
                    <option value="Sim">Sim</option>
                    <option value="Não">Não</option>
                    <option value="Abstenção">Abstenção</option>
                    <option value="Ausente">Ausente</option>
                    <option value="null">Não Informado</option>
                </select>
            </div>
            <div class="col-6 col-md-1 mt-2 mt-md-0">
                <label for="filtroVoto2Turno" class="form-label">
                    <i class="bi bi-check-circle"></i> 2º Turno
                </label>
                <select class="form-select" id="filtroVoto2Turno">
                    <option value="">Todos</option>
                    <option value="Sim">Sim</option>
                    <option value="Não">Não</option>
                    <option value="Abstenção">Abstenção</option>
                    <option value="Ausente">Ausente</option>
                    <option value="null">Não Informado</option>
                </select>
            </div>
            <div class="col-md-3 d-flex align-items-end mt-2 mt-md-0">
                <button class="btn btn-secondary me-2" id="limparFiltros">
                    <i class="bi bi-arrow-clockwise"></i> Limpar
                </button>
                <div class="text-muted mt-2 mt-md-0">
                    Total: <span id="totalDeputados">0</span> deputados
                </div>
            </div>
        </div>

        <div class="table-container overflow-auto">
            <table class="table table-striped table-hover">
                <thead class="table-dark sticky-top">
                    <tr>
                        <th class="text-nowrap"><i class="bi bi-person"></i> Nome</th>
                        <th class="text-nowrap"><i class="bi bi-flag"></i> Partido</th>
                        <th class="text-nowrap"><i class="bi bi-geo-alt"></i> UF</th>
                        <th class="text-nowrap"><i class="bi bi-check-circle"></i> 1º Turno</th>
                        <th class="text-nowrap"><i class="bi bi-check-circle"></i> 2º Turno</th>
                    </tr>
                </thead>
                <tbody id="deputadosTableBody"></tbody>
            </table>
        </div>
    </div>

    <div class="modal fade" id="deputadoModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header pt-2 pb-2">
                    <h5 class="modal-title" id="modalTitle">
                        <i class="bi bi-person-circle"></i> Detalhes do Deputado
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0 m-0" id="modalBody">
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('Service Worker registrado:', registration);
                    })
                    .catch(error => {
                        console.log('Erro ao registrar Service Worker:', error);
                    });
            });
        }

        function handleImageError(img) {
            console.log('Erro ao carregar imagem:', img.src);
            
            const originalSrc = img.getAttribute('data-original-src') || img.src;
            const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(originalSrc)}`;
            
            if (!img.src.includes('allorigins.win')) {
                img.setAttribute('data-original-src', originalSrc);
                img.src = proxyUrl;
                return;
            }
            
            const placeholderSvg = `data:image/svg+xml,${encodeURIComponent(`
                <svg width="150" height="200" xmlns="http://www.w3.org/2000/svg">
                    <rect width="150" height="200" fill="#f8f9fa" stroke="#dee2e6" stroke-width="2"/>
                    <circle cx="75" cy="70" r="25" fill="#6c757d"/>
                    <rect x="50" y="110" width="50" height="70" rx="25" fill="#6c757d"/>
                    <text x="75" y="190" text-anchor="middle" font-family="Arial" font-size="12" fill="#6c757d">Sem foto</text>
                </svg>
            `)}`;
            
            img.src = placeholderSvg;
            img.alt = 'Foto não disponível';
        }
        let deputadosData = [];
        let filteredData = [];

        async function carregarDados() {
            try {
                const response = await fetch("pec-da-blindagem.json");
                deputadosData = await response.json();
                filteredData = [...deputadosData];

                populateFilters();
                renderTable();

                console.log(`Carregados ${deputadosData.length} deputados`);
            } catch (error) {
                console.error("Erro ao carregar dados:", error);
                alert("Erro ao carregar os dados dos deputados.");
            }
        }

        function populateFilters() {
            const partidos = [
                ...new Set(deputadosData.map((d) => d.siglaPartido)),
            ].sort();
            const ufs = [...new Set(deputadosData.map((d) => d.siglaUf))].sort();

            const partidoSelect = document.getElementById("filtroPartido");
            const ufSelect = document.getElementById("filtroUF");

            partidos.forEach((partido) => {
                if (partido) {
                    const option = document.createElement("option");
                    option.value = partido;
                    option.textContent = partido;
                    partidoSelect.appendChild(option);
                }
            });

            ufs.forEach((uf) => {
                if (uf) {
                    const option = document.createElement("option");
                    option.value = uf;
                    option.textContent = uf;
                    ufSelect.appendChild(option);
                }
            });
        }

        function renderTable() {
            const tbody = document.getElementById("deputadosTableBody");
            tbody.innerHTML = "";

            filteredData.forEach((deputado) => {
                const row = document.createElement("tr");
                row.className = "candidate-row";
                row.onclick = () => showDeputadoDetails(deputado);

                const voto1Turno = deputado.voto && deputado.voto["1turno"] ? deputado.voto["1turno"] : null;
                const voto2Turno = deputado.voto && deputado.voto["2turno"] ? deputado.voto["2turno"] : null;
                
                const voto1Class = getVoteClass(voto1Turno);
                const voto2Class = getVoteClass(voto2Turno);
                const voto1Text = voto1Turno || "Não Informado";
                const voto2Text = voto2Turno || "Não Informado";

                row.innerHTML = `
                    <td class="align-middle">
                        ${(voto1Turno === "Sim" || voto2Turno === "Sim") ?
                            `<button class="btn btn-sm btn-info me-md-1 text-nowrap" onclick="event.stopPropagation(); showDeputadoDetails(deputadosData.find(d => d.id === ${deputado.id}))">
                                <i class="bi bi-flag-fill"></i> Protestar
                            </button>` : ''
                        }
                        <strong>${deputado.nomeEleitoral}</strong>
                    </td>
                    <td class="align-middle">
                        <span>${deputado.siglaPartido}</span>
                    </td>
                    <td class="align-middle">
                        <span>${deputado.siglaUf}</span>
                    </td>
                    <td class="align-middle">
                        <span class="${voto1Class}">${voto1Text}</span>
                    </td>
                    <td class="align-middle">
                        <span class="${voto2Class}">${voto2Text}</span>
                    </td>
                `;

                tbody.appendChild(row);
            });

            document.getElementById("totalDeputados").textContent =
                filteredData.length;
        }

        function getVoteClass(voto) {
            switch (voto) {
                case "Sim":
                    return "badge text-bg-danger";
                case "Não":
                    return "badge text-bg-success";
                case "Abstenção":
                    return "badge text-bg-secondary";
                case "Ausente":
                    return "badge text-bg-secondary";
                default:
                    return "badge text-bg-secondary";
            }
        }

        function getSocialMediaIcon(url) {
            const urlLower = url.toLowerCase();
            
            if (urlLower.includes('facebook.com') || urlLower.includes('fb.com')) {
                return 'bi bi-facebook';
            } else if (urlLower.includes('twitter.com') || urlLower.includes('x.com')) {
                return 'bi bi-twitter-x';
            } else if (urlLower.includes('instagram.com')) {
                return 'bi bi-instagram';
            } else if (urlLower.includes('youtube.com') || urlLower.includes('youtu.be')) {
                return 'bi bi-youtube';
            } else if (urlLower.includes('linkedin.com')) {
                return 'bi bi-linkedin';
            } else if (urlLower.includes('whatsapp.com') || urlLower.includes('wa.me')) {
                return 'bi bi-whatsapp';
            } else if (urlLower.includes('telegram.org') || urlLower.includes('t.me')) {
                return 'bi bi-telegram';
            } else if (urlLower.includes('tiktok.com')) {
                return 'bi bi-tiktok';
            } else if (urlLower.includes('github.com')) {
                return 'bi bi-github';
            } else if (urlLower.includes('discord.com') || urlLower.includes('discord.gg')) {
                return 'bi bi-discord';
            } else if (urlLower.includes('snapchat.com')) {
                return 'bi bi-snapchat';
            } else if (urlLower.includes('pinterest.com')) {
                return 'bi bi-pinterest';
            } else if (urlLower.includes('reddit.com')) {
                return 'bi bi-reddit';
            } else if (urlLower.includes('twitch.tv')) {
                return 'bi bi-twitch';
            } else {
                return 'bi bi-link-45deg';
            }
        }

        function showDeputadoDetails(deputado) {
            const modal = new bootstrap.Modal(
                document.getElementById("deputadoModal")
            );
            const modalBody = document.getElementById("modalBody");
            const modalTitle = document.getElementById("modalTitle");

            modalTitle.innerHTML = `<i class="bi bi-person-circle"></i> ${deputado.nome}`;

            emailText = `Prezado ${deputado.nome},

Acompanhei seu voto referente a PEC 3 de 2021, também conhecido como PEC da blindagem, e me causou constrangimento em tomar conhecimento de vossa escolha.

Vivemos em um país onde os políticos poderão se tornar intocáveis, aumentando a quantidade de crimes além de confirmar que a impunidade de corruptos se concretizará. Não acredito que seja esta a vontade de seu eleitorado.

Por isso peço que atue contra a aprovação da PEC no Senado, além de dar maiores explicações para seu eleitorado - como eu - que precisa saber se é representado ou não na Câmara dos Deputados.`;

            socialText = `Prezado ${deputado.nome}, seu voto na PEC 3/21 (PEC da blindagem) envergonha eleitores. Ela cria políticos intocáveis e fortalece a impunidade. Peço que atue contra no Senado e explique sua posição a quem representa.`;

            const socialLinks =
                deputado.redesSociais && deputado.redesSociais.length > 0
                    ? deputado.redesSociais
                        .map(
                            (link) =>
                                `<a href="${link}" target="_blank" class="btn btn-lg btn-primary me-1" title="${link}">
                        <i class="${getSocialMediaIcon(link)}"></i>
                    </a>`
                        )
                        .join("")
                    : '<span class="text-muted">Não informado</span>';

            modalBody.innerHTML = `
                <div class="row p-3">
                    <div class="col-3 col-md-2">
                        <div class="photo-container">
                            <img src="${deputado.urlFoto}?v=1" alt="Foto de ${deputado.nome
                }" class="rounded-3 border border-4 img-fluid"
                                 onerror="handleImageError(this)"
                                 loading="lazy">
                        </div>
                    </div>
                    <div class="col-9 ol-md-8">
                        <h4>${deputado.nome}</h4>
                        <p class="m-0"><strong>Nome Civil:</strong> ${deputado.nomeCivil || "Não informado"
                }</p>
                        <p class="m-0"><strong>Nome Eleitoral:</strong> ${deputado.nomeEleitoral || "Não informado"
                }</p>
                        <p class="m-0"><strong>Partido:</strong> <span>${deputado.siglaPartido
                }</span></p>
                        <p class="m-0"><strong>UF:</strong> <span>${deputado.siglaUf
                }</span></p>
                        <p class="m-0"><strong>1º Turno:</strong> <span class="${getVoteClass(
                    deputado.voto && deputado.voto["1turno"] ? deputado.voto["1turno"] : null
                )}">${deputado.voto && deputado.voto["1turno"] ? deputado.voto["1turno"] : "Não Informado"}</span></p>
                        <p class="m-0"><strong>2º Turno:</strong> <span class="${getVoteClass(
                    deputado.voto && deputado.voto["2turno"] ? deputado.voto["2turno"] : null
                )}">${deputado.voto && deputado.voto["2turno"] ? deputado.voto["2turno"] : "Não Informado"}</span></p>
                    </div>
                </div>
                
                <div class="bg-warning bg-gradient p-4">
                    <div class="copy-section w-100">
                        <h4 class="mb-3 fs-5 text-center w-100">
                            <i class="bi bi-flag-fill"></i> Faça seu protesto por email ou nas redes sociais!
                        </h3>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="social-links pb-2">
                                    ${socialLinks}
                                </div>
                                <label for="socialText" class="form-label">
                                    <i class="bi bi-share"></i> Texto para Redes Sociais
                                </label>
                                <div class="input-group">
                                    <textarea class="form-control" id="socialText" rows="4" readonly>${socialText}</textarea>
                                    <button class="btn btn-primary" type="button" id="copySocial">
                                        <i class="bi bi-clipboard"></i> Copiar
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-6 mt-3 mt-md-0">
                                <div class="email">
                                    <a href="mailto:${deputado.email}">${deputado.email}</a>
                                </div>
                                <label for="emailText" class="form-label">
                                    <i class="bi bi-envelope"></i> Texto para Email
                                </label>
                                <div class="input-group">
                                    <textarea class="form-control" id="emailText" rows="4" readonly>${emailText}</textarea>
                                    <button class="btn btn-primary" type="button" id="copyEmail">
                                        <i class="bi bi-clipboard"></i> Copiar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row p-3">
                    <div class="col-md-6">
                        <h5><i class="bi bi-person-badge"></i> Informações Pessoais</h5>
                        <p class="m-0"><strong>Sexo:</strong> ${deputado.sexo === "M"
                    ? "Masculino"
                    : deputado.sexo === "F"
                        ? "Feminino"
                        : "Não informado"
                }</p>
                        <p class="m-0"><strong>Data de Nascimento:</strong> ${deputado.dataNascimento
                    ? new Date(
                        deputado.dataNascimento
                    ).toLocaleDateString("pt-BR")
                    : "Não informado"
                }</p>
                        <p class="m-0"><strong>Local de Nascimento:</strong> ${deputado.municipioNascimento || "Não informado"
                } - ${deputado.ufNascimento || "Não informado"}</p>
                        <p class="m-0"><strong>Escolaridade:</strong> ${deputado.escolaridade || "Não informado"
                }</p>
                        <p class="m-0"><strong>Situação:</strong> ${deputado.situacao || "Não informado"
                }</p>
                        <p class="m-0"><strong>Condição Eleitoral:</strong> ${deputado.condicaoEleitoral || "Não informado"
                }</p>
                    </div>
                    <div class="col-md-6">
                        <h5><i class="bi bi-building mt-3 mt-md-0"></i> Gabinete</h5>
                        ${deputado.gabinete
                    ? `
                            <p class="m-0"><strong>Sala:</strong> ${deputado.gabinete.nome
                    }</p>
                            <p class="m-0"><strong>Prédio:</strong> ${deputado.gabinete.predio
                    }</p>
                            <p class="m-0"><strong>Andar:</strong> ${deputado.gabinete.andar || "Não informado"
                    }</p>
                            <p class="m-0"><strong>Telefone:</strong> ${deputado.gabinete.telefone
                    }</p>
                        `
                    : "<p class='m-0'>Informações não disponíveis</p>"
                }
                        
                        </p>
                        ${deputado.urlWebsite
                    ? `<p class="m-0"><strong>Website:</strong> <a href="${deputado.urlWebsite}" target="_blank">${deputado.urlWebsite}</a></p>`
                    : ""
                }
                    </div>
                </div>
            `;

            modal.show();
            
            // Adicionar event listeners após o modal ser criado
            document
                .getElementById("copyEmail")
                .addEventListener("click", () =>
                    copyToClipboard("emailText", "copyEmail")
                );
            document
                .getElementById("copySocial")
                .addEventListener("click", () =>
                    copyToClipboard("socialText", "copySocial")
                );
        }

        function applyFilters() {
            const nomeFilter = document
                .getElementById("filtroNome")
                .value.toLowerCase();
            const partidoFilter = document.getElementById("filtroPartido").value;
            const ufFilter = document.getElementById("filtroUF").value;
            const voto1TurnoFilter = document.getElementById("filtroVoto1Turno").value;
            const voto2TurnoFilter = document.getElementById("filtroVoto2Turno").value;

            filteredData = deputadosData.filter((deputado) => {
                const nomeMatch =
                    !nomeFilter ||
                    (deputado.nome && deputado.nome.toLowerCase().includes(nomeFilter)) ||
                    (deputado.nomeEleitoral &&
                        deputado.nomeEleitoral.toLowerCase().includes(nomeFilter)) ||
                    (deputado.nomeCivil &&
                        deputado.nomeCivil.toLowerCase().includes(nomeFilter));

                const partidoMatch =
                    !partidoFilter || deputado.siglaPartido === partidoFilter;
                const ufMatch = !ufFilter || deputado.siglaUf === ufFilter;
                
                const voto1Turno = deputado.voto && deputado.voto["1turno"] ? deputado.voto["1turno"] : null;
                const voto2Turno = deputado.voto && deputado.voto["2turno"] ? deputado.voto["2turno"] : null;
                
                const voto1Match =
                    !voto1TurnoFilter ||
                    (voto1TurnoFilter === "null"
                        ? !voto1Turno
                        : voto1Turno === voto1TurnoFilter);
                        
                const voto2Match =
                    !voto2TurnoFilter ||
                    (voto2TurnoFilter === "null"
                        ? !voto2Turno
                        : voto2Turno === voto2TurnoFilter);

                return nomeMatch && partidoMatch && ufMatch && voto1Match && voto2Match;
            });

            renderTable();
        }

        function clearFilters() {
            document.getElementById("filtroNome").value = "";
            document.getElementById("filtroPartido").value = "";
            document.getElementById("filtroUF").value = "";
            document.getElementById("filtroVoto1Turno").value = "";
            document.getElementById("filtroVoto2Turno").value = "";

            filteredData = [...deputadosData];
            renderTable();
        }

        async function copyToClipboard(elementId, buttonId) {
            const text = document.getElementById(elementId).value;
            const button = document.getElementById(buttonId);

            try {
                await navigator.clipboard.writeText(text);
                const originalContent = button.innerHTML;
                button.innerHTML = '<i class="bi bi-check"></i> Copiado!';
                button.classList.remove("btn-primary", "btn-success");
                button.classList.add("btn-success");

                setTimeout(() => {
                    button.innerHTML = originalContent;
                    button.classList.remove("btn-success");
                    button.classList.add(
                        elementId === "emailText"
                            ? "btn-primary"
                            : "btn-success"
                    );
                }, 2000);
            } catch (err) {
                console.error("Erro ao copiar:", err);
                alert("Erro ao copiar texto. Tente selecionar e copiar manualmente.");
            }
        }

        document.addEventListener("DOMContentLoaded", function () {
            carregarDados();

            document
                .getElementById("filtroNome")
                .addEventListener("input", applyFilters);
            document
                .getElementById("filtroPartido")
                .addEventListener("change", applyFilters);
            document
                .getElementById("filtroUF")
                .addEventListener("change", applyFilters);
            document
                .getElementById("filtroVoto1Turno")
                .addEventListener("change", applyFilters);
            document
                .getElementById("filtroVoto2Turno")
                .addEventListener("change", applyFilters);
            document
                .getElementById("limparFiltros")
                .addEventListener("click", clearFilters);

        });
    </script>
</body>

</html>